<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CV - Modern Template</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            // Suppress Tailwind CDN production warning - CDN is appropriate for this standalone application
            const originalWarn = console.warn;
            console.warn = function(...args) {
                if (args[0] && typeof args[0] === 'string' && args[0].includes('cdn.tailwindcss.com should not be used in production')) {
                    return; // Suppress this specific warning
                }
                originalWarn.apply(console, args);
            };
            
            tailwind.config = {
                darkMode: 'class',
                theme: {
                    extend: {
                        borderRadius: {
                            lg: 'var(--radius)',
                            md: 'calc(var(--radius) - 2px)',
                            sm: 'calc(var(--radius) - 4px)'
                        }
                    }
                }
            }
        </script>
        <!-- html2pdf library -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
        <style>
            /* Base font for entire document */
            body, #cvContainer, #cvContainer * {
                font-family: 'Poppins', 'Arial', sans-serif !important;
            }
            
            /* Print styles with CSS variables */
            @media print {
                :root {
                    --print-width: var(--paper-width);
                    --print-height: var(--paper-height);
                    --print-margin-top: var(--margin-top);
                    --print-margin-right: var(--margin-right);
                    --print-margin-bottom: var(--margin-bottom);
                    --print-margin-left: var(--margin-left);
                }
                html, body {
                    background: white !important;
                    margin: 0 !important;
                    padding: 0 !important;
                    width: var(--print-width);
                    height: var(--print-height);
                    overflow: hidden;
                }
                
                #mainContent,
                #mainContent > div,
                .flex.justify-center {
                    margin: 0 !important;
                    padding: 0 !important;
                }
                
                #cvContainer {
                    box-shadow: none !important;
                    width: var(--print-width) !important;
                    max-width: var(--print-width) !important;
                    min-height: var(--print-height) !important;
                    margin: var(--print-margin-top) var(--print-margin-right) var(--print-margin-bottom) var(--print-margin-left) !important;
                    padding: 0 !important;
                    border-radius: 0 !important;
                    background-color: white !important;
                    color: black !important;
                }
                
                /* Better text rendering for print */
                #cvContainer * {
                    -webkit-print-color-adjust: exact !important;
                    print-color-adjust: exact !important;
                }
            }
            
            :root {
                --radius: 0.65rem;
                --background: 0 0% 100%;
                --foreground: 0 0% 3.9%;
                --card: 0 0% 100%;
                --card-foreground: 0 0% 3.9%;
                --popover: 0 0% 100%;
                --popover-foreground: 0 0% 3.9%;
                --primary: 0 0% 9%;
                --primary-foreground: 0 0% 98%;
                --secondary: 0 0% 96.1%;
                --secondary-foreground: 0 0% 9%;
                --muted: 0 0% 96.1%;
                --muted-foreground: 0 0% 45.1%;
                --accent: 0 0% 96.1%;
                --accent-foreground: 0 0% 9%;
                --destructive: 0 84.2% 60.2%;
                --destructive-foreground: 0 0% 98%;
                --border: 0 0% 89.8%;
                --input: 0 0% 89.8%;
                --ring: 0 0% 3.9%;
                --chart-1: 12 76% 61%;
                --chart-2: 173 58% 39%;
                --chart-3: 197 37% 24%;
                --chart-4: 43 74% 66%;
                --chart-5: 27 87% 67%;
            }

            .dark {
                --background: 0 0% 3.9%;
                --foreground: 0 0% 98%;
                --card: 0 0% 9%;
                --card-foreground: 0 0% 98%;
                --popover: 0 0% 9%;
                --popover-foreground: 0 0% 98%;
                --primary: 0 0% 89.8%;
                --primary-foreground: 0 0% 9%;
                --secondary: 0 0% 14.9%;
                --secondary-foreground: 0 0% 98%;
                --muted: 0 0% 14.9%;
                --muted-foreground: 0 0% 63.9%;
                --accent: 0 0% 14.9%;
                --accent-foreground: 0 0% 98%;
                --destructive: 0 62.8% 30.6%;
                --destructive-foreground: 0 0% 98%;
                --border: 0 0% 100% / 0.1;
                --input: 0 0% 100% / 0.15;
                --ring: 0 0% 45.1%;
                --chart-1: 220 70% 50%;
                --chart-2: 160 60% 45%;
                --chart-3: 30 80% 55%;
                --chart-4: 280 65% 60%;
                --chart-5: 340 75% 55%;
                --sidebar: 0 0% 9%;
                --sidebar-foreground: 0 0% 98%;
                --sidebar-primary: 220 70% 50%;
                --sidebar-primary-foreground: 0 0% 98%;
                --sidebar-accent: 0 0% 14.9%;
                --sidebar-accent-foreground: 0 0% 98%;
                --sidebar-border: 0 0% 100% / 0.1;
                --sidebar-ring: 0 0% 45.1%;
            }

            /* shadcn/ui color utilities for Tailwind v3 */
            .bg-background { background-color: hsl(var(--background)); }
            .bg-card { background-color: hsl(var(--card)); }
            .bg-popover { background-color: hsl(var(--popover)); }
            .bg-primary { background-color: hsl(var(--primary)); }
            .bg-secondary { background-color: hsl(var(--secondary)); }
            .bg-muted { background-color: hsl(var(--muted)); }
            .bg-accent { background-color: hsl(var(--accent)); }
            .bg-destructive { background-color: hsl(var(--destructive)); }
            
            .text-foreground { color: hsl(var(--foreground)); }
            .text-card-foreground { color: hsl(var(--card-foreground)); }
            .text-popover-foreground { color: hsl(var(--popover-foreground)); }
            .text-primary-foreground { color: hsl(var(--primary-foreground)); }
            .text-secondary-foreground { color: hsl(var(--secondary-foreground)); }
            .text-muted-foreground { color: hsl(var(--muted-foreground)); }
            .text-accent-foreground { color: hsl(var(--accent-foreground)); }
            .text-destructive { color: hsl(var(--destructive)); }
            
            .border-border { border-color: hsl(var(--border)); }
            .border-input { border-color: hsl(var(--input)); }
            .ring-ring { --tw-ring-color: hsl(var(--ring)); }
        </style>
    </head>
    <body class="bg-background text-foreground">
        <script src="../script.js"></script>
        
        <div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 p-4 md:p-6 print:p-0 print:m-0 print:bg-white transition-all duration-300" id="mainContent">
            <div class="max-w-4xl mx-auto bg-card rounded-lg shadow-sm print:max-w-none print:shadow-none print:rounded-none print:m-0">
                <!-- Fixed Page Options Menu on Right -->
                <div class="fixed top-1/2 right-4 -translate-y-1/2 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border border-border rounded-lg shadow-lg p-4 print:hidden">
                    <div class="text-xs font-semibold text-muted-foreground mb-3">Page Options</div>
                    <div class="space-y-3">
                        <table class="text-xs text-muted-foreground">
                            <tr>
                                <td class="pr-2 py-1 whitespace-nowrap">Paper Size:</td>
                                <td class="py-1">
                                    <select id="paperSize" class="w-full h-9 rounded-md border border-input bg-background px-2 py-1 text-sm" onchange="updatePaperSize(this.value)">
                                        <option value="letter">Letter</option>
                                        <option value="a4">A4</option>
                                        <option value="legal">Legal</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td class="pr-2 py-1 whitespace-nowrap">Orientation:</td>
                                <td class="py-1">
                                    <select id="orientation" class="w-full h-9 rounded-md border border-input bg-background px-2 py-1 text-sm" onchange="updateOrientation(this.value)">
                                        <option value="portrait">Portrait</option>
                                        <option value="landscape">Landscape</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td class="pr-2 py-1 whitespace-nowrap">Top (mm):</td>
                                <td class="py-1">
                                    <input type="number" id="topMargin" min="0" max="20" step="1" value="10" class="w-full h-9 rounded-md border border-input bg-background px-2 py-1 text-sm text-center" onchange="updateMargin('top', this.value)" oninput="updateMargin('top', this.value)">
                                </td>
                            </tr>
                            <tr>
                                <td class="pr-2 py-1 whitespace-nowrap">Bottom (mm):</td>
                                <td class="py-1">
                                    <input type="number" id="bottomMargin" min="0" max="20" step="1" value="20" class="w-full h-9 rounded-md border border-input bg-background px-2 py-1 text-sm text-center" onchange="updateMargin('bottom', this.value)" oninput="updateMargin('bottom', this.value)">
                                </td>
                            </tr>
                            <tr>
                                <td class="pr-2 py-1 whitespace-nowrap">Right (mm):</td>
                                <td class="py-1">
                                    <input type="number" id="rightMargin" min="0" max="20" step="1" value="0" class="w-full h-9 rounded-md border border-input bg-background px-2 py-1 text-sm text-center" onchange="updateMargin('right', this.value)" oninput="updateMargin('right', this.value)">
                                </td>
                            </tr>
                            <tr>
                                <td class="pr-2 py-1 whitespace-nowrap">Left (mm):</td>
                                <td class="py-1">
                                    <input type="number" id="leftMargin" min="0" max="20" step="1" value="0" class="w-full h-9 rounded-md border border-input bg-background px-2 py-1 text-sm text-center" onchange="updateMargin('left', this.value)" oninput="updateMargin('left', this.value)">
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Fixed Action Buttons at Top -->
                <div class="sticky top-0 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b border-border print:hidden">
                    <div class="p-4 md:p-6">
                        <div class="flex flex-col sm:flex-row gap-4 items-center justify-between">
                            <div class="flex items-center gap-4">
                                <h1 class="text-xl md:text-2xl font-bold tracking-tight">Your CV Preview</h1>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
                                <button onclick="downloadPDF(event)" class="inline-flex items-center justify-center text-sm font-medium transition-colors bg-primary text-primary-foreground hover:bg-primary/90 h-9 rounded-md gap-1.5 px-4 shadow-sm border-0 cursor-pointer flex-1 sm:flex-none">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    Download PDF
                                </button>
                                <button onclick="goBack()" class="inline-flex items-center justify-center text-sm font-medium transition-colors bg-secondary text-secondary-foreground hover:bg-secondary/80 h-9 rounded-md gap-1.5 px-4 shadow-sm border-0 cursor-pointer flex-1 sm:flex-none">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                                    </svg>
                                    Back to Edit
                                </button>
                                <button id="themeToggle" type="button" class="inline-flex items-center justify-center text-sm font-medium transition-colors bg-secondary text-secondary-foreground hover:bg-secondary/80 h-9 w-9 rounded-md shadow-sm border-0 cursor-pointer" aria-label="Toggle theme" title="Toggle light/dark theme">
                                    <svg id="sunIcon" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                    </svg>
                                    <svg id="moonIcon" class="h-5 w-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CV Container -->
                <div class="flex justify-center items-start px-4 print:p-0 print:m-0">
                    <div id="cvContainer" class="bg-white dark:bg-card rounded-lg shadow-lg p-8 print:p-0 print:shadow-none print:rounded-none mx-auto" style="max-width: 600px; min-height: 800px;">
                        <div id="loadingMessage" class="text-center py-8">
                            <p class="text-muted-foreground">Loading CV...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function goBack() {
                window.location.href = '../index.html';
            }

            // Apply margins to CV container
            function applyMargins(margin) {
                const cvContainer = document.getElementById('cvContainer');
                if (!cvContainer) return;
                
                cvContainer.style.marginTop = `${margin[0]}mm`;
                cvContainer.style.marginRight = `${margin[1]}mm`;
                cvContainer.style.marginBottom = `${margin[2]}mm`;
                cvContainer.style.marginLeft = `${margin[3]}mm`;
            }

            // Apply paper size and orientation
            function applyPaperSizeAndOrientation(paperSize, orientation) {
                const cvContainer = document.getElementById('cvContainer');
                if (!cvContainer) return;

                const dimensions = {
                    'letter': { width: 215.9, height: 279.4 },
                    'a4': { width: 210, height: 297 },
                    'legal': { width: 215.9, height: 355.6 }
                };

                let { width, height } = dimensions[paperSize];
                if (orientation === 'landscape') {
                    [width, height] = [height, width];
                }

                cvContainer.style.width = `${width}mm`;
                cvContainer.style.maxWidth = `${width}mm`;
                cvContainer.style.minHeight = `${height}mm`;

                // Set CSS variables for print media query
                document.documentElement.style.setProperty('--paper-width', `${width}mm`);
                document.documentElement.style.setProperty('--paper-height', `${height}mm`);
            }

            // Apply all page settings
            function applyPageSettings() {
                try {
                    const cvDataJson = localStorage.getItem('cvData');
                    let margin = [10, 0, 20, 0];
                    let paperSize = 'letter';
                    let orientation = 'portrait';

                    if (cvDataJson) {
                        const data = JSON.parse(cvDataJson);
                        if (data.margin && Array.isArray(data.margin) && data.margin.length === 4) {
                            margin = data.margin.map(m => Math.max(0, Math.min(20, parseFloat(m) || 0)));
                        }
                        if (data.paperSize) paperSize = data.paperSize;
                        if (data.orientation) orientation = data.orientation;
                    }

                    applyPaperSizeAndOrientation(paperSize, orientation);
                    applyMargins(margin);

                    // Set CSS variables for margins for print media query
                    document.documentElement.style.setProperty('--margin-top', `${margin[0]}mm`);
                    document.documentElement.style.setProperty('--margin-right', `${margin[1]}mm`);
                    document.documentElement.style.setProperty('--margin-bottom', `${margin[2]}mm`);
                    document.documentElement.style.setProperty('--margin-left', `${margin[3]}mm`);

                } catch (e) {
                    console.warn('Could not apply page settings:', e);
                }
            }

            // Load and apply page settings
            function loadPageSettings() {
                try {
                    const cvDataJson = localStorage.getItem('cvData');
                    let margin = [10, 0, 20, 0];
                    let paperSize = 'letter';
                    let orientation = 'portrait';

                    if (cvDataJson) {
                        const data = JSON.parse(cvDataJson);
                        if (data.margin && Array.isArray(data.margin) && data.margin.length === 4) {
                            margin = [
                                Math.max(0, Math.min(20, parseFloat(data.margin[0]) || 10)),
                                Math.max(0, Math.min(20, parseFloat(data.margin[1]) || 0)),
                                Math.max(0, Math.min(20, parseFloat(data.margin[2]) || 20)),
                                Math.max(0, Math.min(20, parseFloat(data.margin[3]) || 0))
                            ];
                        }
                        if (data.paperSize) {
                            paperSize = data.paperSize;
                        }
                        if (data.orientation) {
                            orientation = data.orientation;
                        }
                    }

                    const topMarginInput = document.getElementById('topMargin');
                    const rightMarginInput = document.getElementById('rightMargin');
                    const bottomMarginInput = document.getElementById('bottomMargin');
                    const leftMarginInput = document.getElementById('leftMargin');
                    const paperSizeSelect = document.getElementById('paperSize');
                    const orientationSelect = document.getElementById('orientation');

                    if (topMarginInput) topMarginInput.value = margin[0];
                    if (rightMarginInput) rightMarginInput.value = margin[1];
                    if (bottomMarginInput) bottomMarginInput.value = margin[2];
                    if (leftMarginInput) leftMarginInput.value = margin[3];
                    if (paperSizeSelect) paperSizeSelect.value = paperSize;
                    if (orientationSelect) orientationSelect.value = orientation;

                    applyPageSettings();
                } catch (e) {
                    console.warn('Could not load page settings:', e);
                }
            }

            // Update paper size
            function updatePaperSize(value) {
                const cvDataJson = localStorage.getItem('cvData');
                if (cvDataJson) {
                    try {
                        const data = JSON.parse(cvDataJson);
                        data.paperSize = value;
                        localStorage.setItem('cvData', JSON.stringify(data));
                        savePageSettings();
                        applyPageSettings();
                    } catch (e) {
                        console.error('Error updating paper size:', e);
                    }
                }
            }

            // Update orientation
            function updateOrientation(value) {
                const cvDataJson = localStorage.getItem('cvData');
                if (cvDataJson) {
                    try {
                        const data = JSON.parse(cvDataJson);
                        data.orientation = value;
                        localStorage.setItem('cvData', JSON.stringify(data));
                        savePageSettings();
                        applyPageSettings();
                    } catch (e) {
                        console.error('Error updating orientation:', e);
                    }
                }
            }

            // Update margin
            function updateMargin(side, value) {
                const cvDataJson = localStorage.getItem('cvData');
                if (cvDataJson) {
                    try {
                        const data = JSON.parse(cvDataJson);
                        if (!data.margin || !Array.isArray(data.margin) || data.margin.length !== 4) {
                            data.margin = [10, 0, 20, 0];
                        }
                        const index = { 'top': 0, 'right': 1, 'bottom': 2, 'left': 3 }[side];
                        if (index !== undefined) {
                            data.margin[index] = Math.max(0, Math.min(20, parseFloat(value) || 0));
                            localStorage.setItem('cvData', JSON.stringify(data));
                            savePageSettings();
                            applyPageSettings();
                        }
                    } catch (e) {
                        console.error('Error updating margin:', e);
                    }
                }
            }

            // Save page settings
            function savePageSettings() {
                const topMarginInput = document.getElementById('topMargin');
                const rightMarginInput = document.getElementById('rightMargin');
                const bottomMarginInput = document.getElementById('bottomMargin');
                const leftMarginInput = document.getElementById('leftMargin');
                const paperSizeSelect = document.getElementById('paperSize');
                const orientationSelect = document.getElementById('orientation');

                const margin = [
                    parseFloat(topMarginInput?.value || 10),
                    parseFloat(rightMarginInput?.value || 0),
                    parseFloat(bottomMarginInput?.value || 20),
                    parseFloat(leftMarginInput?.value || 0)
                ];

                const cvDataJson = localStorage.getItem('cvData');
                if (cvDataJson) {
                    try {
                        const data = JSON.parse(cvDataJson);
                        data.margin = margin;
                        data.paperSize = paperSizeSelect?.value || 'letter';
                        data.orientation = orientationSelect?.value || 'portrait';
                        localStorage.setItem('cvData', JSON.stringify(data));
                    } catch (e) {
                        console.error('Error saving page settings:', e);
                    }
                }
            }

            // Download CV as PDF using html2pdf
            async function downloadPDF(event) {
                const cvContainer = document.getElementById('cvContainer');
                if (!cvContainer) {
                    alert('CV container not found');
                    return;
                }

                event.target.disabled = true;
                event.target.textContent = 'Generating PDF...';

                try {
                    const opt = {
                        margin: [0, 0, 0, 0],
                        filename: 'cv.pdf',
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { scale: 2, useCORS: true, letterRendering: true },
                        jsPDF: { unit: 'mm', format: 'letter', orientation: 'portrait' }
                    };

                    // Get page settings
                    const cvDataJson = localStorage.getItem('cvData');
                    if (cvDataJson) {
                        try {
                            const data = JSON.parse(cvDataJson);
                            if (data.paperSize) {
                                const formats = { 'letter': 'letter', 'a4': 'a4', 'legal': 'legal' };
                                opt.jsPDF.format = formats[data.paperSize] || 'letter';
                            }
                            if (data.orientation) {
                                opt.jsPDF.orientation = data.orientation;
                            }
                            if (data.margin && Array.isArray(data.margin) && data.margin.length === 4) {
                                opt.margin = data.margin.map(m => parseFloat(m) || 0);
                            }
                        } catch (e) {
                            console.warn('Could not parse page settings:', e);
                        }
                    }

                    await html2pdf().set(opt).from(cvContainer).save();
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    alert('Error generating PDF. Please try again.');
                } finally {
                    event.target.disabled = false;
                    event.target.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>Download PDF';
                }
            }

            // Theme toggle functionality
            function initTheme() {
                const themeToggle = document.getElementById('themeToggle');
                const sunIcon = document.getElementById('sunIcon');
                const moonIcon = document.getElementById('moonIcon');
                const html = document.documentElement;

                if (!themeToggle || !sunIcon || !moonIcon) {
                    return;
                }

                const savedTheme = localStorage.getItem('theme') || 'light';

                function applyTheme(theme) {
                    if (theme === 'dark') {
                        html.classList.add('dark');
                        sunIcon.classList.add('hidden');
                        moonIcon.classList.remove('hidden');
                    } else {
                        html.classList.remove('dark');
                        sunIcon.classList.remove('hidden');
                        moonIcon.classList.add('hidden');
                    }
                }

                applyTheme(savedTheme);

                themeToggle.addEventListener('click', () => {
                    const currentTheme = html.classList.contains('dark') ? 'dark' : 'light';
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                    applyTheme(newTheme);
                    localStorage.setItem('theme', newTheme);
                });
            }

            // Load CV on page load
            document.addEventListener('DOMContentLoaded', function() {
                initTheme();
                
                try {
                    const cvDataJson = localStorage.getItem('cvData');
                    if (!cvDataJson) {
                        document.getElementById('cvContainer').innerHTML = '<div class="text-center py-8"><p class="text-destructive">No CV data found. Please go back and fill out the form.</p><button onclick="goBack()" class="mt-4 inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 rounded-md gap-1.5 px-4">Go Back</button></div>';
                        return;
                    }

                    const data = JSON.parse(cvDataJson);
                    const template = data.template || 'classic';
                    const cvContainer = document.getElementById('cvContainer');

                    // Hide loading message
                    document.getElementById('loadingMessage').style.display = 'none';

                    // Generate CV directly using inline generation (no template files needed)
                    const html = generateCVFromData(data);
                    cvContainer.innerHTML = html;

                    // Load and apply page settings
                    loadPageSettings();
                    
                    // Ensure page settings are applied after content is rendered
                    setTimeout(() => {
                        applyPageSettings();
                    }, 50);

                } catch (error) {
                    console.error('Error loading CV:', error);
                    document.getElementById('cvContainer').innerHTML = '<div class="text-center py-8"><p class="text-destructive">Error loading CV: ' + error.message + '</p><button onclick="goBack()" class="mt-4 inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 rounded-md gap-1.5 px-4">Go Back</button></div>';
                }
            });
        </script>
    </body>
</html>

